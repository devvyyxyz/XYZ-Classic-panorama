# Pack Format Grouping - Implementation Guide

## Overview
Instead of uploading **98 separate versions** to Modrinth (one for each Minecraft version), the automation now uploads **~10 grouped versions** (one per pack_format), with each Modrinth version listing all supported Minecraft versions.

## Why Group by Pack Format?
- **Efficiency**: Reduces uploads from 98 to ~10
- **Simplicity**: Same resource pack works for all versions with the same pack_format
- **Modrinth Best Practice**: Multiple game versions per upload is standard practice

## Example
**Before** (Individual Uploads):
```
Modrinth Version: "1.21"
  Game Versions: ["1.21"]

Modrinth Version: "1.21.1"
  Game Versions: ["1.21.1"]

Modrinth Version: "1.21.2"
  Game Versions: ["1.21.2"]
...
```

**After** (Grouped by Pack Format):
```
Modrinth Version: "pack-format-12"
  Game Versions: ["1.20", "1.20.1", "1.20.2", "1.20.3", "1.20.4", "1.20.5", "1.20.6", "1.21", "1.21.1", "1.21.2", "1.21.3", "1.21.4"]
  Changelog: "Supports 12 Minecraft versions: 1.20 - 1.21.4"
```

## Implementation Details

### 1. `scripts/resolve_versions.py`
**New Function**: `group_by_pack_format()`
- Groups versions by their pack_format
- Identifies which versions are missing from Modrinth
- Creates version ranges (e.g., "1.20 - 1.21.4")
- Generates version numbers (e.g., "pack-format-12")

**Output Structure**:
```json
{
  "groups_to_upload": [
    {
      "pack_format": 12,
      "version_number": "pack-format-12",
      "version_range": "1.20 - 1.21.4",
      "all_versions": ["1.20", "1.20.1", "1.20.2", ...],
      "missing_versions": ["1.21.3", "1.21.4"]
    }
  ]
}
```

### 2. `scripts/upload_modrinth.py`
**Changed Function Signature**:
```python
# Before
upload_to_modrinth(zip_path, project_id, minecraft_version, api_token, ...)

# After
upload_to_modrinth(zip_path, project_id, game_versions, version_number, api_token, ...)
```

**Parameters**:
- `game_versions`: List of all Minecraft versions (e.g., `["1.20", "1.20.1", ...]`)
- `version_number`: Pack format identifier (e.g., `"pack-format-12"`)

**Changelog Generation**:
```python
changelog = f"Supports {len(game_versions)} Minecraft versions: {version_range}\n\n"
```

### 3. `.github/workflows/auto-update.yml`
**Upload Step Logic**:
```python
for group in groups:
    # Extract group information
    pack_format = group['pack_format']
    version_number = group['version_number']  # "pack-format-12"
    all_versions = group['all_versions']      # ["1.20", "1.20.1", ...]
    
    # Update pack.mcmeta (using first version in group)
    representative_version = all_versions[0]
    update_pack.py(pack.mcmeta, representative_version, pack_format, ...)
    
    # Upload with ALL game versions
    upload_modrinth.py(project_id, version_number, json.dumps(all_versions), token, .)
```

## Pack Format Mapping

| Pack Format | Minecraft Versions | Count |
|------------|-------------------|-------|
| 1 | 1.0 - 1.5.2 | 13 |
| 2 | 1.6.1 - 1.8.9 | 13 |
| 3 | 1.9 - 1.10.2 | 5 |
| 4 | 1.11 - 1.12.2 | 4 |
| 5 | 1.13 - 1.14.4 | 6 |
| 6 | 1.15 - 1.16.1 | 4 |
| 7 | 1.16.2 - 1.16.5 | 4 |
| 8 | 1.17 - 1.17.1 | 2 |
| 9 | 1.18 - 1.18.2 | 3 |
| 10 | 1.19 - 1.19.2 | 3 |
| 11 | 1.19.3 - 1.19.4 | 2 |
| 12 | 1.20 - 1.21.4 | 12 |

**Total**: 12 pack formats covering 98 Minecraft versions

## Workflow Behavior

### Scenario 1: Fresh Project (No Uploads)
- Resolves all 98 Minecraft versions
- Groups into 12 pack_format groups
- Uploads 12 versions to Modrinth
- Each Modrinth version lists all compatible Minecraft versions

### Scenario 2: Partial Uploads
Example: Pack Format 12 exists on Modrinth with versions 1.20 - 1.21.2
- Minecraft 1.21.3 and 1.21.4 are released
- Workflow detects missing versions in Pack Format 12 group
- **Re-uploads** Pack Format 12 with updated game_versions: ["1.20", ..., "1.21.4"]
- Modrinth replaces the old version with the updated one

### Scenario 3: All Up-to-Date
- No missing versions detected
- Workflow exits with: "No pack format groups to upload - all up to date!"

## Expected Output

### Workflow Logs
```
[*] Processing Pack Format 12 (1.20 - 1.21.4)...
    Missing versions: 1.21.3, 1.21.4
    Total versions in group: 12

[+] Successfully updated pack.mcmeta (Pack Format: 12)
[+] Created pack: /tmp/xyz-classic-panorama-pack-format-12.zip
[+] Uploaded pack-format-12 to Modrinth successfully!
    Supported versions: 1.20 - 1.21.4 (12 versions)

[+] Summary:
    Successful: 1
    Failed: 0
[+] Successfully uploaded:
      - pack-format-12 (1.20 - 1.21.4)
```

### Modrinth Version Page
```
Version Name: pack-format-12
Game Versions: 1.20, 1.20.1, 1.20.2, 1.20.3, 1.20.4, 1.20.5, 1.20.6, 1.21, 1.21.1, 1.21.2, 1.21.3, 1.21.4
Changelog: Supports 12 Minecraft versions: 1.20 - 1.21.4

Automatically generated by GitHub Actions
```

## Benefits
1. **Reduced API Calls**: 10x fewer uploads (98 â†’ ~10)
2. **Cleaner Modrinth Page**: Organized by pack format instead of cluttered with 98 versions
3. **Easier Maintenance**: Update one version instead of many
4. **Better User Experience**: Users see clear version ranges
5. **Faster Workflow**: Less time uploading and processing

## Migration Notes
- Existing individual uploads on Modrinth are not affected
- New uploads use the grouped approach
- Version numbers change from "1.21.4" to "pack-format-12"
- All existing functionality remains intact

## Troubleshooting

### Issue: "Version already exists"
If Modrinth returns a conflict error, it means a version with that `version_number` already exists. Options:
1. Use `version_type: "release"` to allow updates
2. Delete the old version from Modrinth manually
3. Change the version naming scheme in `resolve_versions.py`

### Issue: "Invalid game version"
Modrinth may not recognize very old versions (< 1.0). These are excluded from uploads but logged in the output.

### Issue: "No versions to upload"
This is normal when all versions are up-to-date. The workflow exits cleanly.

## Future Enhancements
- [ ] Support snapshots (currently excluded)
- [ ] Custom version naming (e.g., "v1.20-series" instead of "pack-format-12")
- [ ] Incremental updates (only re-upload if new versions added)
- [ ] Version deletion (remove old pack formats)

---
**Last Updated**: 2024 (Pack Format Grouping Implementation)
